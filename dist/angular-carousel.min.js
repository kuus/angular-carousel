/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.3 - 2014-07-20
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["swipe"]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index>0&&a.index--},a.next=function(){a.index<a.items.length-1&&a.index++}},templateUrl:"carousel-controls.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-controls.html",'<div class="rn-carousel-controls">\n  <span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span>\n  <span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span>\n</div>')}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},templateUrl:"carousel-indicators.html"}}]),angular.module("angular-carousel").run(["$templateCache",function(a){a.put("carousel-indicators.html",'<div class="rn-carousel-indicator">\n <span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span>\n</div>')}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["swipe","$window","$document","$parse","$compile","$rootScope",function(a,b,c,d,e,f){var g=0,h=75,i=.05,j=3,k=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame;return{restrict:"A",scope:!0,compile:function(l,m){var n,o,p=l.children()[0].attributes,q=!1,r=!1,s=!1,t=m.rnShowNext,u=!1,v=0,w=!1,x="",y=m.rnCarousel,z="width",A="x",B=l.children();return"vertical"===y&&(w=!0,z="height",A="y",x=" rn-carousel-vertical"),angular.isDefined(t)&&(u=!0,v=isNaN(t)?90:100-t,angular.forEach(B,function(a){a.style.width=v+"%"})),l.addClass("rn-carousel-slides"),B.addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=p[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(n=c[1],o=c[2],n)return angular.isDefined(m.rnCarouselBuffered)&&(r=!0,b.value=n+" in "+o+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),q=!0,!1}return!0}),function(l,m,n){function p(){for(var a=[],b=0;$>b;b++)a[b]=b;l.carouselIndicatorArray=a}function t(){var a=cb.children();return P=0===a.length||u?cb[0].getBoundingClientRect()[z]:a[0].getBoundingClientRect()[z],Q=P/100*v,S=P-Q,R=u?Q:P,P}function y(){db.css(z,"100%");var a=t();a&&db.css(z,a+"px")}function B(a){isNaN(a)&&(a=l.carouselIndex*R),Z=a;var b=-Math.round(Z);b+=l.carouselBufferIndex*R,cb[0].style[T]=ib?w?"translate3d(0, "+b+"px, 0)":"translate3d("+b+"px, 0, 0)":w?"translate(0, "+b+"px)":"translate("+b+"px, 0)"}function C(){var a,b;W&&(a=Date.now()-Y,b=W*Math.exp(-a/h),b>j||-j>b?(B(u?X-H(b)-b:X-b),k(C)):F(X/P))}function D(a){return a>=$?$:0>=a?0:a}function E(){var a=0,b=(l.carouselBufferSize-1)/2;r&&(a=l.carouselIndex<=b?0:$<l.carouselBufferSize?0:l.carouselIndex>$-l.carouselBufferSize?$-l.carouselBufferSize:l.carouselIndex-b),l.carouselBufferIndex=a}function F(a,b){return isNaN(a)&&(a=l.carouselIndex),b?(Z=a*R,void M(null,null,!0)):(l.carouselIndex=D(a),E(),"$apply"!==f.$$phase&&"$digest"!==f.$$phase&&(s?l.$apply():l.$digest()),void B())}function G(){return i*P}function H(a){return a>0?S*(l.carouselIndex+1):S*(l.carouselIndex-1)}function I(a){_=!0,M({x:a.clientX,y:a.clientY},a)}function J(a){var b=a;return 0===l.carouselIndex?b=Math.max(-G(),b):l.carouselIndex===$-1&&(b=Math.min(($-1)*P+G(),b)),b}function K(a,b){return u&&(bb=a),b&&b.stopPropagation(),c.bind("mouseup",I),U=!0,V=a[A],W=0,Y=Date.now(),!1}function L(a,b){var c,d;return U&&(c=a[A],d=V-c,(d>2||-2>d)&&(b&&b.stopPropagation(),_=!0,V=c,k(function(){B(J(Z+d))}))),!1}function M(a,b,d){var e;if(!b||_){if(b&&b.stopPropagation(),c.unbind("mouseup",I),U=!1,_=!1,u){ab=a,console.log("swipeCoordsEnd",ab),e=angular.isObject(bb)&&angular.isObject(ab)&&bb[A]>ab[A]?1:0;var f=l.carouselIndex*P-H(e)}else var f=l.carouselIndex*P;console.log("swipedDelta",e,"scope.carouselIndex",l.carouselIndex,"currentOffset",f),X=Z;var g=G(),h=f-X,i=-Math[h>=0?"ceil":"floor"](h/P),j=Math.abs(h)>g;i+l.carouselIndex>=$&&(i=$-1-l.carouselIndex),i+l.carouselIndex<0&&(i=-l.carouselIndex);var m=j?i:0;return X=(m+l.carouselIndex)*P,W=X-Z,console.log("destination",X,"amplitude",W),Y=Date.now(),d&&(W=Z-f),k(C),!1}}function N(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",msTransform:"-ms-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}function O(){y(),F()}g++;var P,Q,R,S,T,U,V,W,X,Y,Z=0,$=0,_=!1,ab={x:0,y:0},bb={x:0,y:0},cb=m.wrap("<div id='carousel-"+g+"' class='rn-carousel-container"+x+"'></div>"),db=cb.parent();if((angular.isDefined(n.rnCarouselIndicator)||angular.isDefined(n.rnCarouselControl))&&(p(),l.$watch("carouselIndex",function(a){l.indicatorIndex=a}),l.$watch("indicatorIndex",function(a){F(a,!0)})),angular.isDefined(n.rnCarouselIndicator)){var eb=e("<div id='carousel-"+g+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(l);db.append(eb)}if(angular.isDefined(n.rnCarouselControl)){var fb=e("<div id='carousel-"+g+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(l);db.append(fb)}if(l.carouselBufferIndex=0,l.carouselBufferSize=5,l.carouselIndex=0,n.rnCarouselIndex){var gb=function(a){hb.assign(l.$parent,a)},hb=d(n.rnCarouselIndex);angular.isFunction(hb.assign)?(l.$watch("carouselIndex",function(a){gb(a)}),l.carouselIndex=hb(l),l.$parent.$watch(hb,function(a){void 0!==a&&(a>=$?(a=$-1,gb(a)):0>a&&(a=0,gb(a)),F(a,!0))}),s=!0):isNaN(n.rnCarouselIndex)||(l.carouselIndex=parseInt(n.rnCarouselIndex,10))}q?l.$watchCollection(o,function(a){$=0,angular.isArray(a)?$=a.length:angular.isObject(a)&&($=Object.keys(a).length),p(),P||y(),F(l.carouselIndex)}):($=m.children().length,p(),y()),n.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(cb,{start:K,move:L,end:M,cancel:function(a){M({},a)}}):cb.unbind()}),s||F(l.carouselIndex),T="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(T=b,!1):!0});var ib=N(),jb=angular.element(b);jb.bind("orientationchange",O),jb.bind("resize",O),l.$on("$destroy",function(){c.unbind("mouseup",I),jb.unbind("orientationchange",O),jb.unbind("resize",O)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();